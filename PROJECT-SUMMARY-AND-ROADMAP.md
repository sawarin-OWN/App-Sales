# สรุปความคืบหน้าและแผนพัฒนาต่อ — KebYod App

อัปเดต: ก.พ. 2026

---

## 1. สรุปความคืบหน้าของโปรเจกต์

### 1.1 ภาพรวมระบบ

**KebYod App** เป็นแอปเว็บสำหรับบันทึกและรายงานยอดขาย ค่าใช้จ่าย การนำฝาก และงบกำไรขาดทุน ใช้กับหลายสาขา และรองรับทั้งผู้ใช้สาขา (branch), สำนักงาน (office) และแอดมิน (admin)。

- **Frontend:** React 18, Tailwind CSS, Chart.js, SweetAlert2  
- **Backend / DB:** Supabase (Database, Auth, Storage)  
- **Deploy:** Vercel (build จาก Git, ใช้ `index.production.html`)

### 1.2 กลุ่มผู้ใช้และสิทธิ์

| กลุ่ม | Role | การเข้าถึง |
|-------|------|------------|
| **สาขา** | `branch` | Dashboard, ปิดยอด, ค่าใช้จ่าย, นำฝาก, ใบกำกับภาษี, งบกำไรขาดทุน (ของสาขาตนเอง) |
| **สำนักงาน** | `office` | ภาพรวม, ยอดขายสำนักงาน (RANGSAN/SAO), ค่าใช้จ่าย, ใบกำกับภาษี, งบกำไรขาดทุน |
| **แอดมิน** | `admin` | หลังบ้าน: ดู/แก้ไขทุกสาขา, แดชบอร์ดสรุป P&L, แก้ไขยอดขาย/ค่าใช้จ่าย/นำฝาก/งบ P&L ของสาขาใดก็ได้ |

### 1.3 หน้าที่และฟีเจอร์หลัก (ที่ทำแล้ว)

| หน้าที่ | Path | สรุปฟีเจอร์ |
|--------|------|-------------|
| **Login** | `/login` | Email/Password, Session (localStorage), ผูก User กับ Branch/Office/Admin |
| **ภาพรวม** | `/dashboard` | การ์ดยอดขายรวม/กำไรขั้นต้น/ค่าใช้จ่าย/จำนวนรายการ, การ์ดจากงบ P&L (ต้นทุน, ค่าใช้จ่ายดำเนินการ, ยอดนำฝาก, กำไรสุทธิ), กรองช่วงวันที่, ตารางยอดขาย, กราฟแนวโน้มและช่องทางชำระเงิน |
| **ปิดยอด** | `/sales` | บันทึกยอดรายวัน (เงินสด/โอน/Grab/Lineman/Shopee ฯลฯ), เงินสดตั้งต้น/นับได้, ค่าใช้จ่ายเงินสดของวัน, แนบรูป, แก้ไข/ลบรายการ |
| **ค่าใช้จ่าย** | `/expenses` | บันทึกค่าใช้จ่ายหลายประเภท (เบิกเงินลิ้นชัก, วัตถุดิบ, สติ๊กเกอร์ ฯลฯ), แนบรูป, แก้ไข/ลบ |
| **นำฝาก** | `/deposits` | บันทึกยอดนำฝาก, แก้ไข/ลบ |
| **ใบกำกับภาษี** | `/tax-invoices` | บันทึกใบกำกับ, ผูกผู้เสียภาษี, แก้ไข/ลบ |
| **งบกำไรขาดทุน** | `/profit-loss` | ดู/แก้ไขงบ P&L ของสาขา, เทียบเดือน, ส่วนที่ 2 COGS รวมค่าใช้จ่ายทุกประเภทจากหน้ากรอกค่าใช้จ่าย, บิลส่วนกลาง, Export HTML/PDF |
| **ยอดขายสำนักงาน** | `/office-sales` | บันทึกยอด RANGSAN/SAO ตามวันที่, แท็บกลับแดชบอร์ด |
| **หลังบ้าน (Admin)** | `/admin` | เลือกสาขา/หลายสาขา, การ์ดสรุป, สรุปยอดตามสาขา, ยอดนำฝาก, แก้ไข Sales/Expenses/Deposits/TaxInvoices/P&L ของสาขา, แดชบอร์ดสรุป P&L (เทียบสาขา/เทียบเดือน) |

### 1.4 โครงสร้างเทคนิคที่สำคัญ

- **API:** `src/services/api.js` → ใช้ `supabaseAPI.js` (Supabase เป็น backend เดียว)
- **Auth:** `AuthContext.js` — Login ผ่านตาราง User (Email/Password), ไม่ใช้ Supabase Auth
- **Cache:** `DataCacheContext.js` — cache ข้อมูลดาชบอร์ด/รายการเพื่อลดโหลด
- **Build:** `prebuild` คัดลอก `index.production.html` → `index.html` ก่อน `react-scripts build`
- **PWA / Splash:** ใช้ `index.html` / `index.production.html` (Splash KebYod App, gradient เขียว–ขาว, ไอคอน MENU (7).png)

### 1.5 สิ่งที่ปรับปรุงในช่วงที่ผ่านมา (สรุปสั้น)

- เปลี่ยนชื่อแอปเป็น KebYod App (title, meta, manifest, ข้อความในแอป)
- Navbar: หัวข้อพื้นขาว, แถบแท็บพื้น #12467d
- หน้าโหลด: ข้อความ KebYod App, สีตามโลโก้, gradient เขียว–ขาว
- ช่องวันที่: ใช้ input เดียว ไม่ซ้อนไอคอน, เปิดปฏิทินได้ทั้งเว็บและมือถือ
- การ์ดตัวเลข: ขนาดฟอนต์เท่ากันทุกการ์ด, ไม่ล้นบรรทัด, แสดงเต็มไม่ซ่อน (ปรับ scale ตามความยาวตัวเลข)
- งบ P&L ส่วนที่ 2 COGS: “จากหน้ากรอกค่าใช้จ่าย” รวมยอดทุกประเภทในเดือนที่เลือก (ไม่จำกัดเฉพาะซื้อของนอก)
- แก้ ESLint (ลบ import ไม่ใช้) ให้ build บน Vercel ผ่าน

---

## 2. แผนพัฒนาต่อในอนาคต

### 2.1 ระยะสั้น (ปรับปรุงเสถียรภาพและ UX)

| ลำดับ | รายการ | หมายเหตุ |
|-------|--------|----------|
| 1 | **ทดสอบและแก้บั๊กบนมือถือ** | ตรวจสอบช่องวันที่, การ์ดตัวเลข, scroll และ safe area บน iOS/Android |
| 2 | **ปรับปรุง Error handling** | แจ้งข้อความเมื่อโหลดข้อมูลไม่สำเร็จ / Supabase ล้ม ให้ผู้ใช้เข้าใจและ retry ได้ |
| 3 | **Loading state ให้ครบ** | หน้าหลักๆ มี loading หรือ skeleton ชัดเจน ไม่ให้รู้สึกค้าง |
| 4 | **Export งบ P&L** | ตรวจสอบการ export HTML/PDF บนมือถือ และปรับ layout ให้อ่านง่าย |

### 2.2 ระยะกลาง (ฟีเจอร์และข้อมูล)

| ลำดับ | รายการ | หมายเหตุ |
|-------|--------|----------|
| 1 | **Dashboard Office ให้สมบูรณ์** | ถ้ามีข้อมูลยอด RANGSAN/SAO เพิ่ม อาจเพิ่มการ์ดหรือกราฟเฉพาะ Office ในภาพรวม |
| 2 | **รายงานช่วงวันที่ยืดหยุ่น** | งบ P&L หรือรายงานบางส่วนรองรับเลือกช่วงวันที่ (ไม่จำกัดแค่เดือน) |
| 3 | **การแจ้งเตือน/สรุป** | แจ้งเตือนเมื่อมีรายการค้าง (เช่น ยังไม่ปิดยอด, ยังไม่นำฝาก) หรือสรุปรายวัน/รายสัปดาห์ (ถ้าต้องการ) |
| 4 | **สิทธิ์และการ audit** | กำหนด role ชัดเจน (branch/office/admin), บันทึกว่าใครแก้ไขอะไรเมื่อไหร่ (audit log) ถ้าต้องการ |

### 2.3 ระยะยาว (ขยายระบบ)

| ลำดับ | รายการ | หมายเหตุ |
|-------|--------|----------|
| 1 | **Multi-tenant / หลายองค์กร** | แยกข้อมูลตามองค์กร (เช่น แต่ละแบรนด์/บริษัท) ไม่ปะปนระหว่างกัน |
| 2 | **API สำหรับระบบภายนอก** | เปิด API (อ่านยอด, สรุป) ให้ POS หรือระบบอื่นดึงข้อมูลได้อย่างปลอดภัย |
| 3 | **รายงานขั้นสูง** | Pivot, เทียบสาขา/ช่วงเวลา, KPI เพิ่ม (เช่น ยอดเฉลี่ยต่อวัน, อัตราส่วนต้นทุน) |
| 4 | **PWA / Offline** | บันทึกแบบ offline แล้ว sync เมื่อกลับออนไลน์ (ต้องออกแบบ conflict และ sync rule) |

### 2.4 สิ่งที่ควรทำควบคู่กัน

- **เอกสาร:** อัปเดต USER-GUIDE, QUICK-START และ DEPLOY-VERCEL ให้ตรงกับฟีเจอร์และขั้นตอนล่าสุด
- **ทดสอบ:** เขียนเทสสำหรับฟังก์ชันสำคัญ (login, บันทึกยอด, คำนวณงบ P&L) ถ้าต้องการลด regression
- **ความปลอดภัย:** ตรวจสอบ RLS และสิทธิ์ใน Supabase ให้ตรงกับ role (branch/office/admin) และไม่ให้ user อื่นแก้ข้อมูลข้ามสาขา

---

## 3. สรุปสั้น

- โปรเจกต์ **KebYod App** มีความคืบหน้าครบตามเป้า: Login, Dashboard, ปิดยอด, ค่าใช้จ่าย, นำฝาก, ใบกำกับภาษี, งบกำไรขาดทุน, ยอดขายสำนักงาน, หลังบ้าน Admin และแดชบอร์ดสรุป P&L
- พัฒนาต่อควรเน้น **ระยะสั้น**: เสถียรภาพ, UX บนมือถือ, การแสดงตัวเลขและการ์ด, และการจัดการ error/loading ให้ชัดเจน จากนั้นค่อยขยายเป็นฟีเจอร์รายงานและสิทธิ์ (ระยะกลาง) และ multi-tenant / API / รายงานขั้นสูง (ระยะยาว)

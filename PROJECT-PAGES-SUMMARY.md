# สรุปหน้าตามโปรเจกต์ (KebYod App)

## ภาพรวม

โปรเจกต์มี **2 กลุ่มหลัก**: หน้าสำหรับ **ผู้ใช้สาขา (User)** และ **หลังบ้าน (Admin)**  
- **User**: แต่ละคนผูกกับสาขาเดียว (branchCode) ใช้บันทึก/ดูข้อมูลของสาขานั้น  
- **Admin**: เข้าตรวจสอบและแก้ไขข้อมูลของทุกสาขาได้  

ในอนาคตจะเพิ่ม **ประเภทผู้ใช้สำนักงาน (Office)** สำหรับเก็บยอดขายของสำนักงาน โดยช่องทางกรอกยอดจะไม่เหมือนสาขา (โครงสร้างเตรียมไว้ในเอกสารแยก)

---

## 1. หน้าสาขา (ผู้ใช้ User)

|  path | หน้าที่ | สถานะ |
|------|--------|--------|
| `/dashboard` | ภาพรวมยอดขาย, กราฟ, สรุป | โดยรวมดี อาจปรับแต่งเพิ่มเล็กน้อย |
| `/sales` | ปิดยอดขาย (บันทึกยอดรายวัน: เงินสด, โอน, Grab, Lineman, ฯลฯ) | ใช้ได้ |
| `/expenses` | บันทึกค่าใช้จ่าย | ใช้ได้ |
| `/deposits` | บันทึกการนำฝากเงินสด | ใช้ได้ |
| `/tax-invoices` | บันทึกใบกำกับภาษี | ใช้ได้ |
| `/profit-loss` | งบกำไรขาดทุนของสาขา (ดู/แก้ไข, เทียบเดือน) | ใช้ได้ |

**การเข้าถึง:** หลัง Login ระบบใช้ `user.branchCode` / `user.branchName` จากตาราง `User` แสดงเมนูด้านบน และทุก API ใช้ branch ของ user นั้น  
**สิทธิ์ Admin:** ถ้า `user.role === 'admin'` หรือ email มีคำว่า `admin` จะเห็นเมนู "หลังบ้าน" ด้วย

---

## 2. หลังบ้าน (Admin)

**วัตถุประสงค์:** เข้าตรวจสอบและแก้ไขข้อมูลของทุกสาขา

แผนที่ต้องการ:

- **มีแค่ 2 ส่วนหลักในหน้า Admin**
  1. **หลังบ้าน** – ตรวจสอบ/แก้ไขข้อมูลทุกสาขา (ยอดขาย, ค่าใช้จ่าย, นำฝาก, งบกำไรขาดทุนของแต่ละสาขา)
  2. **งบกำไรขาดทุน** – ดู/แก้ไขงบสาขาเดียว หรือเทียบหลายสาขา/เทียบเดือน (เหมือนปัจจุบัน)

- **เพิ่มอีก 1 หน้าใน Admin**
  - **แดชบอร์ดสรุปทุกสาขา (P&L Summary)**  
    - ดึงข้อมูลจากงบกำไรขาดทุนทั้งหมด  
    - เลือกสาขาได้ (สาขาเดียว หรือหลายสาขา หรือรวมทุกสาขา)  
    - แสดงสรุปเชิงลึกสำหรับวิเคราะห์ (เช่น ยอดขายรวม, กำไรขั้นต้น, ค่าใช้จ่ายดำเนินการ, กำไรสุทธิ แยกตามสาขา/เวลา)

### โครงสร้าง Admin (ทำแล้ว)

| แท็บ | รายละเอียด |
|------|------------|
| **หลังบ้าน + งบกำไรขาดทุน** | เลือกสาขา, วันที่, การ์ดยอดขาย/กำไร/ค่าใช้จ่าย/จำนวนรายการ, สรุปยอดตามสาขา, การนำฝาก, งบกำไรขาดทุน (ดู/แก้สาขาเดียว + เทียบหลายสาขา), กราฟ |
| **แดชบอร์ดสรุป P&L** | เลือกสาขา (หรือไม่เลือก = ทุกสาขา), เลือกเดือน + เทียบเดือน, โหลดข้อมูลจากงบกำไรขาดทุน → ตารางสรุปเชิงลึก (ยอดขายรวม, หลังหักส่วนลด, COGS, กำไรขั้นต้น, ค่าใช้จ่ายดำเนินการ, กำไรสุทธิ) |

---

## 3. ประเภทผู้ใช้เพิ่ม: สำนักงาน (Office)

- **วัตถุประสงค์:** เก็บข้อมูลยอดขายของสำนักงาน  
- **ความต่างจากสาขา:** ช่องทางในการกรอกยอดจะไม่เหมือนสาขา (สาขาใช้ Cash, Transfer, Grab, Lineman, Shopee, Robinhood, Credit card, HalfHalf, Other เป็นต้น; สำนักงานอาจเป็นช่องทางอื่น เช่น โครงการ A/B, สัญญา, บริการ ฯลฯ)

**โครงสร้างที่เตรียมไว้:** ดูไฟล์ `docs/OFFICE-USER-STRUCTURE.md` และ SQL ใน `supabase-office-user.sql`  
ประกอบด้วย:
- เพิ่มคอลัมน์ **Role** ในตาราง `User` (เช่น `branch` | `admin` | `office`)
- ตาราง **OfficeSales** (หรือชื่อที่ตกลง) สำหรับบันทึกยอดขายสำนักงาน — ชื่อคอลัมน์ช่องทางจะต่างจาก `Sales` (เตรียม placeholder ไว้ แล้วค่อยกำหนดชื่อช่องทางจริงตามที่ต้องการ)

---

## 4. สรุปเส้นทาง (Routes)

| Path | กลุ่ม | หมายเหตุ |
|------|--------|----------|
| `/login` | - | ล็อกอิน |
| `/dashboard` | User | ภาพรวมสาขา |
| `/sales` | User | ปิดยอด |
| `/expenses` | User | ค่าใช้จ่าย |
| `/deposits` | User | นำฝาก |
| `/tax-invoices` | User | ใบกำกับภาษี |
| `/profit-loss` | User | งบกำไรขาดทุนสาขา |
| `/admin` | Admin | หลังบ้าน + งบกำไรขาดทุน (แท็บที่ 1) และ แดชบอร์ดสรุป P&L (แท็บที่ 2) |
| `/office-sales` | Office | ยอดขายสำนักงาน — โครงสร้างพร้อม, ฟอร์มรอกำหนดช่องทาง (placeholder) |

เมื่อผู้ใช้มี `role === 'office'` จะเห็นเฉพาะเมนู "ยอดขายสำนักงาน" และเข้าหน้า `/office-sales` (หลัง Login จะ redirect ไปที่หน้านี้)
